# Average Wait Gauge Feature ğŸ“Š

## Overview

The Average Wait stat card now includes a **dynamic visual gauge** that shows where the average wait sits relative to the current maximum wait time in the system.

---

## Visual Features

### **1. Gradient Bar**
```
Green â†’ Yellow â†’ Red
ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”â”â”â”â”â”â”ğŸ”´
0m                    317m
```

- **Green zone (0-33%)**: Low stress
- **Yellow zone (33-66%)**: Moderate stress  
- **Red zone (66-100%)**: High stress

### **2. Position Indicator**
- Black vertical bar showing exact average position
- Smooth animation when data updates
- Responsive to live data changes

### **3. Tick Marks**
- Faint white lines every 50m
- Provides visual rhythm without clutter
- Helps estimate position at a glance

### **4. Scale Label**
```
0m    Scale: 0â€“317m    317m
```
- Shows dynamic range based on current max
- Updates with every data refresh
- Ghosted middle label for context

---

## How It Works

### **Dynamic Scaling**
The gauge **always scales to current data**, not a fixed range:

```javascript
// Calculate max wait from current hospitals
const maxWait = Math.max(...validWaits);  // e.g., 317m

// Calculate average
const avgWait = sum(waits) / count(waits);  // e.g., 187m

// Position on gauge
const percentage = (187 / 317) * 100;  // = 59%
```

### **Example Scenarios**

#### **High Stress Day:**
```
Max Wait: 317m
Average:  187m
Position: 59% (middle-right, amber zone)

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”â”â”â”|â”â”â”ğŸ”´
0m          187m   317m
```

#### **Low Stress Day:**
```
Max Wait: 145m
Average:  68m
Position: 47% (middle, yellow zone)

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”|â”â”â”â”ğŸ”´
0m         68m    145m
```

#### **Critical Day:**
```
Max Wait: 420m
Average:  285m
Position: 68% (right, red zone)

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”â”â”â”â”â”â”|ğŸ”´
0m               285m  420m
```

---

## Visual Components

### **HTML Structure**
```html
<!-- Dynamic gauge bar -->
<div class="relative mt-3">
    <!-- Background with gradient -->
    <div class="h-2 rounded-full" 
         style="background: linear-gradient(to right, 
                #10B981 0%, #FBBF24 50%, #EF4444 100%);">
        
        <!-- Tick marks overlay -->
        <div id="avg-wait-ticks">
            <!-- Generated by JavaScript -->
        </div>
    </div>
    
    <!-- Position indicator -->
    <div id="avg-wait-indicator" 
         style="left: 59%;">
    </div>
    
    <!-- Scale label -->
    <div>
        <span>0m</span>
        <span id="avg-wait-scale">Scale: 0â€“317m</span>
        <span id="avg-wait-max">317m</span>
    </div>
</div>
```

### **JavaScript Logic**
```javascript
function updateAverageWaitGauge(hospitals) {
    // 1. Get valid wait times
    const validWaits = hospitals
        .filter(h => typeof h.wait === 'number')
        .map(h => h.wait);
    
    // 2. Calculate max and average
    const maxWait = Math.max(...validWaits);
    const avgWait = sum(validWaits) / validWaits.length;
    
    // 3. Position indicator
    const percentage = (avgWait / maxWait) * 100;
    indicator.style.left = `${percentage}%`;
    
    // 4. Update labels
    scaleLabel.textContent = `Scale: 0â€“${maxWait}m`;
    maxLabel.textContent = `${maxWait}m`;
    
    // 5. Generate tick marks every 50m
    const numTicks = Math.floor(maxWait / 50);
    for (let i = 1; i < numTicks; i++) {
        const tickPosition = (i * 50 / maxWait) * 100;
        // Create tick at tickPosition%
    }
}
```

---

## Benefits

### **1. Instant Context**
- See average position at a glance
- No mental math required
- Visual stress indicator

### **2. Relative Perspective**
- 187m means different things on different days
- Gauge shows **relative stress**, not just raw number
- Adapts to system capacity

### **3. Trend Awareness**
- When max = 145m, avg 68m = "normal"
- When max = 420m, avg 285m = "crisis"
- Gauge position tells the real story

---

## Color Psychology

### **Gradient Zones**

| Zone | Color | Position | Meaning |
|------|-------|----------|---------|
| **Green** | #10B981 | 0-33% | System handling load well |
| **Yellow** | #FBBF24 | 33-66% | Moderate pressure |
| **Red** | #EF4444 | 66-100% | High system stress |

### **Indicator**
- **Light theme**: Dark gray (#111827)
- **Dark theme**: Light gray (#F1F5F9) with glow
- High contrast against gradient background

---

## Dark Mode

The gauge adapts beautifully to dark mode:

### **Light Mode:**
```
Dark indicator on bright gradient
Clear tick marks (white, 30% opacity)
```

### **Dark Mode:**
```
Light indicator with subtle glow
Tick marks blend into gradient
Scale labels in slate-400
```

---

## Integration with Python

When generating the dashboard from Python:

```python
dashboard_data = {
    'hospitals': [
        {'name': 'Hospital A', 'wait': 317},
        {'name': 'Hospital B', 'wait': 281},
        # ... more hospitals
    ],
    'avgWait': '<span class="text-orange-500">187m</span>',
    # ... other data
}

# The JavaScript will automatically:
# 1. Calculate max wait (317m)
# 2. Calculate average wait (187m)
# 3. Position indicator at 59%
# 4. Generate 6 tick marks (50, 100, 150, 200, 250, 300)
# 5. Update scale to "0â€“317m"
```

No additional calculations needed in Python!

---

## Examples by System Load

### **Low Load (All hospitals < 150m)**
```
Max: 145m | Avg: 68m | Position: 47%

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”|â”â”â”â”â”ğŸ”´
           â†‘
      "Comfortable"
```

### **Medium Load (Some > 200m)**
```
Max: 289m | Avg: 142m | Position: 49%

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”|â”â”â”â”â”â”â”ğŸ”´
           â†‘
       "Stretched"
```

### **High Load (Multiple > 240m)**
```
Max: 317m | Avg: 187m | Position: 59%

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”â”â”â”|â”â”â”ğŸ”´
              â†‘
         "Under strain"
```

### **Crisis Load (Multiple > 300m)**
```
Max: 420m | Avg: 285m | Position: 68%

ğŸŸ¢â”â”â”â”â”â”â”â”ğŸŸ¡â”â”â”â”â”â”â”â”|ğŸ”´
                  â†‘
            "Critical"
```

---

## Technical Details

### **Tick Mark Calculation**
```javascript
// If max wait = 317m
const numTicks = Math.floor(317 / 50);  // = 6 ticks

// Ticks at: 50m, 100m, 150m, 200m, 250m, 300m
// Positions: 15.8%, 31.5%, 47.3%, 63.1%, 78.9%, 94.6%
```

### **Gradient Breakpoints**
```css
background: linear-gradient(to right, 
    #10B981 0%,     /* Pure green at start */
    #FBBF24 50%,    /* Pure yellow at middle */
    #EF4444 100%    /* Pure red at end */
);
```

### **Smooth Transitions**
```css
#avg-wait-indicator {
    transition: left 0.3s ease-in-out;
}
```
Indicator smoothly slides when data updates.

---

## Testing

### **View in Browser:**
```
dashboard.html
```

The gauge initializes with sample data:
- Max wait: 317m
- Average: ~187m
- Position: ~59%
- 6 tick marks visible

### **Test Different Scenarios:**

```javascript
// Low stress
updateAverageWaitGauge([
    {wait: 45}, {wait: 62}, {wait: 78}, {wait: 52}
]);
// Max: 78m, Avg: ~59m, Position: ~76% (feels high relative to max)

// High stress  
updateAverageWaitGauge([
    {wait: 420}, {wait: 380}, {wait: 310}, {wait: 250}
]);
// Max: 420m, Avg: ~340m, Position: ~81% (crisis level)
```

---

## Summary

### **What It Shows:**
- Where average wait sits on a 0-to-max scale
- Relative system stress (not absolute)
- Visual context with gradient colors

### **Why It's Useful:**
- âœ… Instant visual understanding
- âœ… Adapts to current system capacity
- âœ… Shows stress, not just numbers
- âœ… No fixed assumptions (dynamic scaling)
- âœ… Beautiful and functional

### **Technical Highlights:**
- ğŸ¨ Green â†’ Yellow â†’ Red gradient
- ğŸ“ Dynamic 0-to-max scaling
- âš¡ Smooth animations
- ğŸŒ™ Dark mode support
- ğŸ“Š Tick marks every 50m
- ğŸ¯ Responsive indicator positioning

---

**The gauge transforms raw numbers into instant visual context!** ğŸ“Šâœ¨
